(()=>{"use strict";var t={82:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CancelButton=void 0;class n extends HTMLButtonElement{constructor(t,e,n){super(),this.container=t,this.editor=e,this.selection=n,this.setAttribute("class","cancel"),this.textContent="Cancel",this.addEventListener("click",this.handleClick.bind(this))}handleClick(){this.editor.anno.cancelSelected(),this.container.dataset.annotationId?this.editor.makeReadOnly(this.container,this.selection):this.container.remove()}}e.CancelButton=n},578:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DeleteButton=void 0;class n extends HTMLButtonElement{constructor(t,e){super(),this.container=t,this.editor=e,this.setAttribute("class","delete"),this.textContent="Delete",this.addEventListener("click",this.handleClick.bind(this))}handleClick(){this.editor.anno.removeAnnotation(this.container.dataset.annotationId),this.container.remove(),this.editor.storage.adapter.delete(this.container.dataset.annotationId)}}e.DeleteButton=n},917:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SaveButton=void 0;class n extends HTMLButtonElement{constructor(t,e,n,i){super(),this.container=t,this.editor=e,this.selection=n,this.textInput=i,this.setAttribute("class","save"),this.textContent="Save",this.addEventListener("click",this.handleClick.bind(this))}async handleClick(){this.selection.motivation="supplementing",Array.isArray(this.selection.body)&&0==this.selection.body.length?this.selection.body.push({type:"TextualBody",purpose:"transcribing",value:this.textInput.textContent||"",format:"text/html"}):Array.isArray(this.selection.body)&&(this.selection.body[0].value=this.textInput.textContent||""),console.log(this.selection),await this.editor.anno.updateSelected(this.selection),this.editor.anno.saveSelected(),this.editor.makeReadOnly(this.container)}}e.SaveButton=n}},e={};function n(i){var o=e[i];if(void 0!==o)return o.exports;var a=e[i]={exports:{}};return t[i](a,a.exports,n),a.exports}var i={};(()=>{var t=i;Object.defineProperty(t,"__esModule",{value:!0});const e=n(82),o=n(578),a=n(917);t.default=class{constructor(t,n,i){this.anno=t,this.storage=n,this.anno.disableEditor=!0,this.annotationContainer=i,customElements.define("save-button",a.SaveButton,{extends:"button"}),customElements.define("cancel-button",e.CancelButton,{extends:"button"}),customElements.define("delete-button",o.DeleteButton,{extends:"button"}),document.addEventListener("annotations-loaded",this.handleAnnotationsLoaded.bind(this)),this.anno.on("createSelection",this.handleCreateSelection.bind(this)),this.anno.on("selectAnnotation",this.handleSelectAnnotation.bind(this))}handleAnnotationsLoaded(){this.annotationContainer.querySelectorAll(".annotation-display-container").forEach((t=>t.remove())),this.anno.getAnnotations().forEach((t=>{this.annotationContainer.append(this.createDisplayBlock(t))}))}async handleCreateSelection(t){const e=this.createEditorBlock(t);e&&this.annotationContainer.append(e)}handleSelectAnnotation(t){this.makeAllReadOnly();const e=document.querySelector('[data-annotation-id="'+t.id+'"]');e&&e instanceof HTMLElement&&this.makeEditable(e,t)}createDisplayBlock(t){const e=document.createElement("div");e.setAttribute("class","annotation-display-container");const n=document.createElement("div");return Array.isArray(t.body)&&t.body.length>0&&(n.innerHTML=t.body[0].value),e.append(n),void 0!==t.id&&(e.dataset.annotationId=t.id,n.addEventListener("click",(()=>{this.anno.selectAnnotation(t.id),this.makeAllReadOnly(),this.makeEditable(e,t)}))),e}makeEditable(t,n){if("annotation-edit-container"==t.getAttribute("class"))return;t.setAttribute("class","annotation-edit-container");const i=t.querySelector("div");return i&&(i.setAttribute("class","annotation-editor"),i.setAttribute("contenteditable","true"),i.focus(),t.append(new a.SaveButton(t,this,n,i)),t.append(new e.CancelButton(t,this,n))),t.dataset.annotationId&&t.append(new o.DeleteButton(t,this)),t}makeReadOnly(t,e){t.setAttribute("class","annotation-display-container");const n=t.querySelector("div");return n&&(n.setAttribute("class",""),n.setAttribute("contenteditable","false"),e&&void 0!==e.body&&Array.isArray(e.body)&&(n.innerHTML=e.body[0].value,this.anno.addAnnotation(e))),t.querySelectorAll("button").forEach((t=>t.remove())),t}makeAllReadOnly(){document.querySelectorAll(".annotation-edit-container").forEach((t=>{t instanceof HTMLElement&&this.makeReadOnly(t)}))}createEditorBlock(t){return this.makeEditable(this.createDisplayBlock(t),t)}}})(),module.exports=i})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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L2Fubm90b3Jpb3VzLXRhaHFpcS8uL3NyYy9lbGVtZW50cy9DYW5jZWxCdXR0b24udHMiLCJ3ZWJwYWNrOi8vYW5ub3RvcmlvdXMtdGFocWlxLy4vc3JjL2VsZW1lbnRzL0RlbGV0ZUJ1dHRvbi50cyIsIndlYnBhY2s6Ly9hbm5vdG9yaW91cy10YWhxaXEvLi9zcmMvZWxlbWVudHMvU2F2ZUJ1dHRvbi50cyIsIndlYnBhY2s6Ly9hbm5vdG9yaW91cy10YWhxaXEvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vYW5ub3RvcmlvdXMtdGFocWlxLy4vc3JjL2luZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFubm90YXRpb24gfSBmcm9tIFwiLi4vdHlwZXMvQW5ub3RhdGlvblwiO1xuXG5jbGFzcyBDYW5jZWxCdXR0b24gZXh0ZW5kcyBIVE1MQnV0dG9uRWxlbWVudCB7XG4gICAgY29udGFpbmVyOiBIVE1MRWxlbWVudDtcblxuICAgIGVkaXRvcjogYW55O1xuXG4gICAgc2VsZWN0aW9uOiBBbm5vdGF0aW9uO1xuXG4gICAgY29uc3RydWN0b3IoY29udGFpbmVyOiBIVE1MRWxlbWVudCwgZWRpdG9yOiBhbnksIHNlbGVjdGlvbjogQW5ub3RhdGlvbikge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xuICAgICAgICB0aGlzLmVkaXRvciA9IGVkaXRvcjtcbiAgICAgICAgdGhpcy5zZWxlY3Rpb24gPSBzZWxlY3Rpb247XG5cbiAgICAgICAgLy8gU2V0IGNsYXNzIGFuZCBjb250ZW50XG4gICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJjYW5jZWxcIik7XG4gICAgICAgIHRoaXMudGV4dENvbnRlbnQgPSBcIkNhbmNlbFwiO1xuXG4gICAgICAgIC8vIEF0dGFjaCBjbGljayBoYW5kbGVyXG4gICAgICAgIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuaGFuZGxlQ2xpY2suYmluZCh0aGlzKSk7XG4gICAgfVxuXG4gICAgaGFuZGxlQ2xpY2soKSB7XG4gICAgICAgIC8vIGNhbmNlbCB0aGUgZWRpdFxuICAgICAgICAvLyBjbGVhciB0aGUgc2VsZWN0aW9uIGZyb20gdGhlIGltYWdlXG4gICAgICAgIHRoaXMuZWRpdG9yLmFubm8uY2FuY2VsU2VsZWN0ZWQoKTtcbiAgICAgICAgLy8gaWYgYW5ub3RhdGlvbiBpcyB1bnNhdmVkLCByZXN0b3JlIGFuZCBtYWtlIHJlYWQgb25seVxuICAgICAgICBpZiAodGhpcy5jb250YWluZXIuZGF0YXNldC5hbm5vdGF0aW9uSWQpIHtcbiAgICAgICAgICAgIHRoaXMuZWRpdG9yLm1ha2VSZWFkT25seSh0aGlzLmNvbnRhaW5lciwgdGhpcy5zZWxlY3Rpb24pO1xuICAgICAgICAgICAgLy8gaWYgdGhpcyB3YXMgYSBuZXcgYW5ub3RhdGlvbiwgcmVtb3ZlIHRoZSBjb250YWluZXJcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgeyBDYW5jZWxCdXR0b24gfTtcbiIsImNsYXNzIERlbGV0ZUJ1dHRvbiBleHRlbmRzIEhUTUxCdXR0b25FbGVtZW50IHtcbiAgICBjb250YWluZXI6IEhUTUxFbGVtZW50O1xuXG4gICAgZWRpdG9yOiBhbnk7XG4gICAgXG4gICAgY29uc3RydWN0b3IoY29udGFpbmVyOiBIVE1MRWxlbWVudCwgZWRpdG9yOiBhbnkpIHtcbiAgICAgICAgc3VwZXIoKTtcblxuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgICAgICAgdGhpcy5lZGl0b3IgPSBlZGl0b3I7XG5cbiAgICAgICAgLy8gQ2xhc3MgYW5kIGNvbnRlbnRcbiAgICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcImRlbGV0ZVwiKTtcbiAgICAgICAgdGhpcy50ZXh0Q29udGVudCA9IFwiRGVsZXRlXCI7XG5cbiAgICAgICAgdGhpcy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5oYW5kbGVDbGljay5iaW5kKHRoaXMpKTtcbiAgICB9XG5cbiAgICBoYW5kbGVDbGljaygpIHtcbiAgICAgICAgLy8gcmVtb3ZlIHRoZSBoaWdobGlnaHQgem9uZSBmcm9tIHRoZSBpbWFnZVxuICAgICAgICB0aGlzLmVkaXRvci5hbm5vLnJlbW92ZUFubm90YXRpb24odGhpcy5jb250YWluZXIuZGF0YXNldC5hbm5vdGF0aW9uSWQpO1xuICAgICAgICAvLyByZW1vdmUgdGhlIGVkaXQvZGlzcGxheSBjb250YWluZXJcbiAgICAgICAgdGhpcy5jb250YWluZXIucmVtb3ZlKCk7XG4gICAgICAgIC8vIGNhbGxpbmcgcmVtb3ZlQW5ub3RhdGlvbiBkb2Vzbid0IGZpcmUgdGhlIGRlbGV0ZUFubm90YXRpb24sXG4gICAgICAgIC8vIHNvIHdlIGhhdmUgdG8gdHJpZ2dlciB0aGUgZGVsZXRpb24gZXhwbGljaXRseVxuICAgICAgICB0aGlzLmVkaXRvci5zdG9yYWdlLmFkYXB0ZXIuZGVsZXRlKHRoaXMuY29udGFpbmVyLmRhdGFzZXQuYW5ub3RhdGlvbklkKTtcbiAgICB9XG59XG5cbmV4cG9ydCB7IERlbGV0ZUJ1dHRvbiB9O1xuIiwiaW1wb3J0IHsgQW5ub3RhdGlvbiB9IGZyb20gXCIuLi90eXBlcy9Bbm5vdGF0aW9uXCI7XG5cbmNsYXNzIFNhdmVCdXR0b24gZXh0ZW5kcyBIVE1MQnV0dG9uRWxlbWVudCB7XG4gICAgY29udGFpbmVyOiBIVE1MRWxlbWVudDtcblxuICAgIGVkaXRvcjtcblxuICAgIHNlbGVjdGlvbjogQW5ub3RhdGlvbjtcblxuICAgIHRleHRJbnB1dDogSFRNTERpdkVsZW1lbnQ7XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgY29udGFpbmVyOiBIVE1MRWxlbWVudCxcbiAgICAgICAgZWRpdG9yOiBhbnksXG4gICAgICAgIHNlbGVjdGlvbjogQW5ub3RhdGlvbixcbiAgICAgICAgdGV4dElucHV0OiBIVE1MRGl2RWxlbWVudCxcbiAgICApIHtcbiAgICAgICAgc3VwZXIoKTtcblxuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgICAgICAgdGhpcy5lZGl0b3IgPSBlZGl0b3I7XG4gICAgICAgIHRoaXMuc2VsZWN0aW9uID0gc2VsZWN0aW9uO1xuICAgICAgICB0aGlzLnRleHRJbnB1dCA9IHRleHRJbnB1dDtcblxuICAgICAgICAvLyBTZXQgY2xhc3MgYW5kIGNvbnRlbnRcbiAgICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcInNhdmVcIik7XG4gICAgICAgIHRoaXMudGV4dENvbnRlbnQgPSBcIlNhdmVcIjtcblxuICAgICAgICAvLyBBdHRhY2ggY2xpY2sgaGFuZGxlclxuICAgICAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLmhhbmRsZUNsaWNrLmJpbmQodGhpcykpO1xuICAgIH1cblxuICAgIGFzeW5jIGhhbmRsZUNsaWNrKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICAvLyBhZGQgdGhlIGNvbnRlbnQgdG8gdGhlIGFubm90YXRpb25cbiAgICAgICAgdGhpcy5zZWxlY3Rpb24ubW90aXZhdGlvbiA9IFwic3VwcGxlbWVudGluZ1wiO1xuICAgICAgICBpZiAoXG4gICAgICAgICAgICBBcnJheS5pc0FycmF5KHRoaXMuc2VsZWN0aW9uLmJvZHkpICYmXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGlvbi5ib2R5Lmxlbmd0aCA9PSAwXG4gICAgICAgICkge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb24uYm9keS5wdXNoKHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcIlRleHR1YWxCb2R5XCIsXG4gICAgICAgICAgICAgICAgcHVycG9zZTogXCJ0cmFuc2NyaWJpbmdcIixcbiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy50ZXh0SW5wdXQudGV4dENvbnRlbnQgfHwgXCJcIixcbiAgICAgICAgICAgICAgICBmb3JtYXQ6IFwidGV4dC9odG1sXCIsXG4gICAgICAgICAgICAgICAgLy8gVE9ETzogdHJhbnNjcmlwdGlvbiBtb3RpdmF0aW9uLCBsYW5ndWFnZSwgZXRjLlxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLnNlbGVjdGlvbi5ib2R5KSkge1xuICAgICAgICAgICAgLy8gYXNzdW1lIHRleHQgY29udGVudCBpcyBmaXJzdCBib2R5IGVsZW1lbnRcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9uLmJvZHlbMF0udmFsdWUgPSB0aGlzLnRleHRJbnB1dC50ZXh0Q29udGVudCB8fCBcIlwiO1xuICAgICAgICB9XG4gICAgICAgIC8vIHVwZGF0ZSB3aXRoIGFubm90b3Jpb3VzLCB0aGVuIHNhdmUgdG8gc3RvcmFnZSBiYWNrZW5kXG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuc2VsZWN0aW9uKTtcbiAgICAgICAgYXdhaXQgdGhpcy5lZGl0b3IuYW5uby51cGRhdGVTZWxlY3RlZCh0aGlzLnNlbGVjdGlvbik7XG4gICAgICAgIHRoaXMuZWRpdG9yLmFubm8uc2F2ZVNlbGVjdGVkKCk7XG4gICAgICAgIC8vIG1ha2UgdGhlIGVkaXRvciBpbmFjdGl2ZVxuICAgICAgICB0aGlzLmVkaXRvci5tYWtlUmVhZE9ubHkodGhpcy5jb250YWluZXIpO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgU2F2ZUJ1dHRvbiB9O1xuIiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXShtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIGN1c3RvbSBhbm5vdGF0aW9uIGVkaXRvciBmb3IgZ2VuaXphIHByb2plY3RcblxuaW1wb3J0IHsgQ2FuY2VsQnV0dG9uIH0gZnJvbSBcIi4vZWxlbWVudHMvQ2FuY2VsQnV0dG9uXCI7XG5pbXBvcnQgeyBEZWxldGVCdXR0b24gfSBmcm9tIFwiLi9lbGVtZW50cy9EZWxldGVCdXR0b25cIjtcbmltcG9ydCB7IFNhdmVCdXR0b24gfSBmcm9tIFwiLi9lbGVtZW50cy9TYXZlQnV0dG9uXCI7XG5pbXBvcnQgeyBBbm5vdGF0aW9uIH0gZnJvbSBcIi4vdHlwZXMvQW5ub3RhdGlvblwiO1xuXG5jbGFzcyBUcmFuc2NyaXB0aW9uRWRpdG9yIHtcbiAgICBhbm5vO1xuXG4gICAgYW5ub3RhdGlvbkNvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG5cbiAgICBzdG9yYWdlO1xuXG4gICAgLy8gVE9ETzogQWRkIHR5cGVkZWZzIGZvciB0aGUgQW5ub3RvcmlvdXMgY2xpZW50IChhbm5vKSBhbmQgc3RvcmFnZSBwbHVnaW5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgIGNvbnN0cnVjdG9yKGFubm86IGFueSwgc3RvcmFnZTogYW55LCBhbm5vdGF0aW9uQ29udGFpbmVyOiBIVE1MRWxlbWVudCkge1xuICAgICAgICB0aGlzLmFubm8gPSBhbm5vO1xuICAgICAgICB0aGlzLnN0b3JhZ2UgPSBzdG9yYWdlO1xuICAgICAgICAvLyBkaXNhYmxlIHRoZSBkZWZhdWx0IGFubm90b3Jpb3VzIGVkaXRvciAoaGVhZGxlc3MgbW9kZSlcbiAgICAgICAgdGhpcy5hbm5vLmRpc2FibGVFZGl0b3IgPSB0cnVlO1xuICAgICAgICB0aGlzLmFubm90YXRpb25Db250YWluZXIgPSBhbm5vdGF0aW9uQ29udGFpbmVyO1xuXG4gICAgICAgIC8vIGRlZmluZSBjdXN0b20gZWxlbWVudHNcbiAgICAgICAgY3VzdG9tRWxlbWVudHMuZGVmaW5lKFwic2F2ZS1idXR0b25cIiwgU2F2ZUJ1dHRvbiwgeyBleHRlbmRzOiBcImJ1dHRvblwiIH0pO1xuICAgICAgICBjdXN0b21FbGVtZW50cy5kZWZpbmUoXCJjYW5jZWwtYnV0dG9uXCIsIENhbmNlbEJ1dHRvbiwgeyBleHRlbmRzOiBcImJ1dHRvblwiIH0pO1xuICAgICAgICBjdXN0b21FbGVtZW50cy5kZWZpbmUoXCJkZWxldGUtYnV0dG9uXCIsIERlbGV0ZUJ1dHRvbiwgeyBleHRlbmRzOiBcImJ1dHRvblwiIH0pO1xuXG4gICAgICAgIC8vIGF0dGFjaCBldmVudCBsaXN0ZW5lcnNcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgICAgIFwiYW5ub3RhdGlvbnMtbG9hZGVkXCIsXG4gICAgICAgICAgICB0aGlzLmhhbmRsZUFubm90YXRpb25zTG9hZGVkLmJpbmQodGhpcyksXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMuYW5uby5vbihcImNyZWF0ZVNlbGVjdGlvblwiLCB0aGlzLmhhbmRsZUNyZWF0ZVNlbGVjdGlvbi5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5hbm5vLm9uKFxuICAgICAgICAgICAgXCJzZWxlY3RBbm5vdGF0aW9uXCIsXG4gICAgICAgICAgICB0aGlzLmhhbmRsZVNlbGVjdEFubm90YXRpb24uYmluZCh0aGlzKSxcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBoYW5kbGVBbm5vdGF0aW9uc0xvYWRlZCgpIHtcbiAgICAgICAgLy8gY3VzdG9tIGV2ZW50IHRyaWdnZXJlZCBieSBzdG9yYWdlIHBsdWdpblxuXG4gICAgICAgIC8vIHJlbW92ZSBhbnkgZXhpc3RpbmcgYW5ub3RhdGlvbiBkaXNwbGF5cywgaW4gY2FzZSBvZiB1cGRhdGVcbiAgICAgICAgdGhpcy5hbm5vdGF0aW9uQ29udGFpbmVyXG4gICAgICAgICAgICAucXVlcnlTZWxlY3RvckFsbChcIi5hbm5vdGF0aW9uLWRpc3BsYXktY29udGFpbmVyXCIpXG4gICAgICAgICAgICAuZm9yRWFjaCgoZWwpID0+IGVsLnJlbW92ZSgpKTtcbiAgICAgICAgLy8gZGlzcGxheSBhbGwgY3VycmVudCBhbm5vdGF0aW9uc1xuICAgICAgICB0aGlzLmFubm8uZ2V0QW5ub3RhdGlvbnMoKS5mb3JFYWNoKChhbm5vdGF0aW9uOiBBbm5vdGF0aW9uKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmFubm90YXRpb25Db250YWluZXIuYXBwZW5kKFxuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlRGlzcGxheUJsb2NrKGFubm90YXRpb24pLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgYXN5bmMgaGFuZGxlQ3JlYXRlU2VsZWN0aW9uKHNlbGVjdGlvbjogQW5ub3RhdGlvbikge1xuICAgICAgICAvLyB3aGVuIGEgbmV3IHNlbGVjdGlvbiBpcyBtYWRlLCBpbnN0YW50aWF0ZSBhbiBlZGl0b3JcbiAgICAgICAgY29uc3QgZWRpdG9yQmxvY2sgPSB0aGlzLmNyZWF0ZUVkaXRvckJsb2NrKHNlbGVjdGlvbik7XG4gICAgICAgIGlmIChlZGl0b3JCbG9jaykgdGhpcy5hbm5vdGF0aW9uQ29udGFpbmVyLmFwcGVuZChlZGl0b3JCbG9jayk7XG4gICAgfVxuXG4gICAgaGFuZGxlU2VsZWN0QW5ub3RhdGlvbihhbm5vdGF0aW9uOiBBbm5vdGF0aW9uKSB7XG4gICAgICAgIC8vIFRoZSB1c2VyIGhhcyBzZWxlY3RlZCBhbiBleGlzdGluZyBhbm5vdGF0aW9uXG4gICAgICAgIC8vIG1ha2Ugc3VyZSBubyBvdGhlciBlZGl0b3IgaXMgYWN0aXZlXG4gICAgICAgIHRoaXMubWFrZUFsbFJlYWRPbmx5KCk7XG4gICAgICAgIC8vIGZpbmQgdGhlIGRpc3BsYXkgZWxlbWVudCBieSBhbm5vdGF0aW9uIGlkIGFuZCBzd2l0aCB0byBlZGl0IG1vZGVcbiAgICAgICAgY29uc3QgZGlzcGxheUNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgICAnW2RhdGEtYW5ub3RhdGlvbi1pZD1cIicgKyBhbm5vdGF0aW9uLmlkICsgJ1wiXScsXG4gICAgICAgICk7XG4gICAgICAgIGlmIChkaXNwbGF5Q29udGFpbmVyICYmIGRpc3BsYXlDb250YWluZXIgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkge1xuICAgICAgICAgICAgdGhpcy5tYWtlRWRpdGFibGUoZGlzcGxheUNvbnRhaW5lciwgYW5ub3RhdGlvbik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjcmVhdGVEaXNwbGF5QmxvY2soYW5ub3RhdGlvbjogQW5ub3RhdGlvbik6IEhUTUxFbGVtZW50IHtcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgY29udGFpbmVyLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwiYW5ub3RhdGlvbi1kaXNwbGF5LWNvbnRhaW5lclwiKTtcbiAgICAgICAgY29uc3QgdGV4dElucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShhbm5vdGF0aW9uLmJvZHkpICYmIGFubm90YXRpb24uYm9keS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0ZXh0SW5wdXQuaW5uZXJIVE1MID0gYW5ub3RhdGlvbi5ib2R5WzBdLnZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmQodGV4dElucHV0KTtcblxuICAgICAgICAvLyBleGlzdGluZyBhbm5vdGF0aW9uXG4gICAgICAgIGlmIChhbm5vdGF0aW9uLmlkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbnRhaW5lci5kYXRhc2V0LmFubm90YXRpb25JZCA9IGFubm90YXRpb24uaWQ7XG5cbiAgICAgICAgICAgIC8vIHdoZW4gdGhpcyBkaXNwbGF5IGlzIGNsaWNrZWQsIGhpZ2hsaWdodCB0aGUgem9uZSBhbmQgbWFrZSBlZGl0YWJsZVxuICAgICAgICAgICAgdGV4dElucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hbm5vLnNlbGVjdEFubm90YXRpb24oYW5ub3RhdGlvbi5pZCk7XG4gICAgICAgICAgICAgICAgLy8gbWFrZSBzdXJlIG5vIG90aGVyIGVkaXRvcnMgYXJlIGFjdGl2ZVxuICAgICAgICAgICAgICAgIHRoaXMubWFrZUFsbFJlYWRPbmx5KCk7XG4gICAgICAgICAgICAgICAgLy8gc2VsZWN0aW9uIGV2ZW50IG5vdCBmaXJlZCBpbiB0aGlzIGNhc2UsIHNvIG1ha2UgZWRpdGFibGVcbiAgICAgICAgICAgICAgICB0aGlzLm1ha2VFZGl0YWJsZShjb250YWluZXIsIGFubm90YXRpb24pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbnRhaW5lcjtcbiAgICB9XG5cbiAgICBtYWtlRWRpdGFibGUoY29udGFpbmVyOiBIVE1MRWxlbWVudCwgc2VsZWN0aW9uOiBBbm5vdGF0aW9uKSB7XG4gICAgICAgIC8vIG1ha2UgYW4gZXhpc3RpbmcgZGlzcGxheSBjb250YWluZXIgZWRpdGFibGVcblxuICAgICAgICAvLyBpZiBpdCdzIGFscmVhZHkgZWRpdGFibGUsIGRvbid0IGRvIGFueXRoaW5nXG4gICAgICAgIGlmIChjb250YWluZXIuZ2V0QXR0cmlidXRlKFwiY2xhc3NcIikgPT0gXCJhbm5vdGF0aW9uLWVkaXQtY29udGFpbmVyXCIpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcImFubm90YXRpb24tZWRpdC1jb250YWluZXJcIik7XG4gICAgICAgIGNvbnN0IHRleHRJbnB1dCA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiZGl2XCIpO1xuICAgICAgICBpZiAodGV4dElucHV0KSB7XG4gICAgICAgICAgICB0ZXh0SW5wdXQuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJhbm5vdGF0aW9uLWVkaXRvclwiKTtcbiAgICAgICAgICAgIHRleHRJbnB1dC5zZXRBdHRyaWJ1dGUoXCJjb250ZW50ZWRpdGFibGVcIiwgXCJ0cnVlXCIpO1xuICAgICAgICAgICAgdGV4dElucHV0LmZvY3VzKCk7XG4gICAgICAgICAgICAvLyBhZGQgc2F2ZSBhbmQgY2FuY2VsIGJ1dHRvbnNcbiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmQoXG4gICAgICAgICAgICAgICAgbmV3IFNhdmVCdXR0b24oY29udGFpbmVyLCB0aGlzLCBzZWxlY3Rpb24sIHRleHRJbnB1dCksXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZChuZXcgQ2FuY2VsQnV0dG9uKGNvbnRhaW5lciwgdGhpcywgc2VsZWN0aW9uKSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBpZiB0aGlzIGlzIGEgc2F2ZWQgYW5ub3RhdGlvbiwgYWRkIGRlbGV0ZSBidXR0b25cbiAgICAgICAgaWYgKGNvbnRhaW5lci5kYXRhc2V0LmFubm90YXRpb25JZCkge1xuICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZChuZXcgRGVsZXRlQnV0dG9uKGNvbnRhaW5lciwgdGhpcykpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGNvbnRhaW5lcjtcbiAgICB9XG5cbiAgICBtYWtlUmVhZE9ubHkoY29udGFpbmVyOiBIVE1MRWxlbWVudCwgYW5ub3RhdGlvbj86IEFubm90YXRpb24pIHtcbiAgICAgICAgLy8gY29udmVydCBhIGNvbnRhaW5lciB0aGF0IGhhcyBiZWVuIG1hZGUgZWRpdGFibGUgYmFjayB0byBkaXNwbGF5IGZvcm1hdFxuICAgICAgICAvLyBhbm5vdGF0aW9uIGlzIG9wdGlvbmFsOyB1c2VkIHRvIHJlc2V0IGNvbnRlbnQgaWYgbmVjZXNzYXJ5XG4gICAgICAgIGNvbnRhaW5lci5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcImFubm90YXRpb24tZGlzcGxheS1jb250YWluZXJcIik7XG4gICAgICAgIGNvbnN0IHRleHRJbnB1dCA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiZGl2XCIpO1xuICAgICAgICBpZiAodGV4dElucHV0KSB7XG4gICAgICAgICAgICB0ZXh0SW5wdXQuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJcIik7XG4gICAgICAgICAgICB0ZXh0SW5wdXQuc2V0QXR0cmlidXRlKFwiY29udGVudGVkaXRhYmxlXCIsIFwiZmFsc2VcIik7XG4gICAgICAgICAgICAvLyByZXN0b3JlIHRoZSBvcmlnaW5hbCBjb250ZW50XG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgYW5ub3RhdGlvbiAmJlxuICAgICAgICAgICAgICAgIGFubm90YXRpb24uYm9keSAhPT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgICAgICAgQXJyYXkuaXNBcnJheShhbm5vdGF0aW9uLmJvZHkpXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICB0ZXh0SW5wdXQuaW5uZXJIVE1MID0gYW5ub3RhdGlvbi5ib2R5WzBdLnZhbHVlO1xuICAgICAgICAgICAgICAgIC8vIGFkZCB0aGUgYW5ub3RhdGlvbiBhZ2FpbiB0byB1cGRhdGUgdGhlIGltYWdlIHNlbGVjdGlvbiByZWdpb24sXG4gICAgICAgICAgICAgICAgLy8gaW4gY2FzZSB0aGUgdXNlciBoYXMgbW9kaWZpZWQgaXQgYW5kIHdhbnRzIHRvIGNhbmNlbFxuICAgICAgICAgICAgICAgIHRoaXMuYW5uby5hZGRBbm5vdGF0aW9uKGFubm90YXRpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIHJlbW92ZSBidXR0b25zIChvciBzaG91bGQgd2UganVzdCBoaWRlIHRoZW0/KVxuICAgICAgICBjb250YWluZXIucXVlcnlTZWxlY3RvckFsbChcImJ1dHRvblwiKS5mb3JFYWNoKChlbCkgPT4gZWwucmVtb3ZlKCkpO1xuXG4gICAgICAgIHJldHVybiBjb250YWluZXI7XG4gICAgfVxuXG4gICAgbWFrZUFsbFJlYWRPbmx5KCkge1xuICAgICAgICAvLyBtYWtlIHN1cmUgbm8gZWRpdG9yIGlzIGFjdGl2ZVxuICAgICAgICBkb2N1bWVudFxuICAgICAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuYW5ub3RhdGlvbi1lZGl0LWNvbnRhaW5lclwiKVxuICAgICAgICAgICAgLmZvckVhY2goKGNvbnRhaW5lcikgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChjb250YWluZXIgaW5zdGFuY2VvZiBIVE1MRWxlbWVudClcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tYWtlUmVhZE9ubHkoY29udGFpbmVyKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIG1ldGhvZCB0byBjcmVhdGUgYW4gZWRpdG9yIGJsb2NrXG4gICAgLy8gY29udGFpbmVyLCBlZGl0YWJsZSBkaXYsIGJ1dHRvbnMgdG8gc2F2ZS9jYW5jZWwvZGVsZXRlXG4gICAgY3JlYXRlRWRpdG9yQmxvY2soc2VsZWN0aW9uOiBBbm5vdGF0aW9uKSB7XG4gICAgICAgIC8vIGNyZWF0ZSBhIG5ldyBhbm5vdGF0aW9uIGVkaXRvciBibG9jayBhbmQgcmV0dXJuXG4gICAgICAgIHJldHVybiB0aGlzLm1ha2VFZGl0YWJsZSh0aGlzLmNyZWF0ZURpc3BsYXlCbG9jayhzZWxlY3Rpb24pLCBzZWxlY3Rpb24pO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgVHJhbnNjcmlwdGlvbkVkaXRvcjtcbiJdLCJuYW1lcyI6WyJDYW5jZWxCdXR0b24iLCJIVE1MQnV0dG9uRWxlbWVudCIsImNvbnN0cnVjdG9yIiwiY29udGFpbmVyIiwiZWRpdG9yIiwic2VsZWN0aW9uIiwic3VwZXIiLCJ0aGlzIiwic2V0QXR0cmlidXRlIiwidGV4dENvbnRlbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiaGFuZGxlQ2xpY2siLCJiaW5kIiwiYW5ubyIsImNhbmNlbFNlbGVjdGVkIiwiZGF0YXNldCIsImFubm90YXRpb25JZCIsIm1ha2VSZWFkT25seSIsInJlbW92ZSIsIkRlbGV0ZUJ1dHRvbiIsInJlbW92ZUFubm90YXRpb24iLCJzdG9yYWdlIiwiYWRhcHRlciIsImRlbGV0ZSIsIlNhdmVCdXR0b24iLCJ0ZXh0SW5wdXQiLCJhc3luYyIsIm1vdGl2YXRpb24iLCJBcnJheSIsImlzQXJyYXkiLCJib2R5IiwibGVuZ3RoIiwicHVzaCIsInR5cGUiLCJwdXJwb3NlIiwidmFsdWUiLCJmb3JtYXQiLCJjb25zb2xlIiwibG9nIiwidXBkYXRlU2VsZWN0ZWQiLCJzYXZlU2VsZWN0ZWQiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJ1bmRlZmluZWQiLCJleHBvcnRzIiwibW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsImFubm90YXRpb25Db250YWluZXIiLCJkaXNhYmxlRWRpdG9yIiwiY3VzdG9tRWxlbWVudHMiLCJkZWZpbmUiLCJleHRlbmRzIiwiZG9jdW1lbnQiLCJoYW5kbGVBbm5vdGF0aW9uc0xvYWRlZCIsIm9uIiwiaGFuZGxlQ3JlYXRlU2VsZWN0aW9uIiwiaGFuZGxlU2VsZWN0QW5ub3RhdGlvbiIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiZWwiLCJnZXRBbm5vdGF0aW9ucyIsImFubm90YXRpb24iLCJhcHBlbmQiLCJjcmVhdGVEaXNwbGF5QmxvY2siLCJlZGl0b3JCbG9jayIsImNyZWF0ZUVkaXRvckJsb2NrIiwibWFrZUFsbFJlYWRPbmx5IiwiZGlzcGxheUNvbnRhaW5lciIsInF1ZXJ5U2VsZWN0b3IiLCJpZCIsIkhUTUxFbGVtZW50IiwibWFrZUVkaXRhYmxlIiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsInNlbGVjdEFubm90YXRpb24iLCJnZXRBdHRyaWJ1dGUiLCJmb2N1cyIsImFkZEFubm90YXRpb24iXSwic291cmNlUm9vdCI6IiJ9